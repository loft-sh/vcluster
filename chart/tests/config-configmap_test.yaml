suite: test config-configmap
templates:
  - config-configmap.yaml
  - config-secret.yaml
  - statefulset.yaml
release:
  name: release-name
  namespace: test-namespace
tests:
  - it: should create a ConfigMap and not a Secret when useConfigMap is true
    set:
      controlPlane.advanced.useConfigMap: true
    asserts:
      - hasDocuments:
          count: 1
        template: config-configmap.yaml
      - hasDocuments:
          count: 0
        template: config-secret.yaml
      - matchRegex:
          path: spec.template.spec.volumes[?(@.name=="vcluster-config")].configMap.name
          pattern: vc-config-release-name
        template: statefulset.yaml

  - it: should create a Secret and not a ConfigMap when useConfigMap is false
    set:
      controlPlane.advanced.useConfigMap: false
    asserts:
      - hasDocuments:
          count: 0
        template: config-configmap.yaml
      - hasDocuments:
          count: 1
        template: config-secret.yaml
      - matchRegex:
          path: spec.template.spec.volumes[?(@.name=="vcluster-config")].secret.secretName
          pattern: vc-config-release-name
        template: statefulset.yaml
